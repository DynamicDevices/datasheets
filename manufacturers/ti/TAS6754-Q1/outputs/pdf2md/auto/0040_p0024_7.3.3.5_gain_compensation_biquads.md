# 7.3.3.5 Gain Compensation Biquads

The gain compensation biquads are used to compensate for the frequency response variations introduced by the speaker and enclosure. These biquads can be configured as peaking filters, low-shelf filters, or high-shelf filters to provide equalization across the audio spectrum.

Each gain compensation biquad implements a second-order IIR filter with configurable coefficients. The filter transfer function is given by:

H(z) = (b0 + b1·z⁻¹ + b2·z⁻²) / (a0 + a1·z⁻¹ + a2·z⁻²)

Where:
- b0, b1, b2 are the numerator coefficients
- a0, a1, a2 are the denominator coefficients
- The a0 coefficient is typically normalized to 1

## Configuration

The gain compensation biquads are configured through a set of coefficient registers. Each biquad requires five coefficients to be programmed:

- **b0** - Numerator coefficient 0
- **b1** - Numerator coefficient 1
- **b2** - Numerator coefficient 2
- **a1** - Denominator coefficient 1
- **a2** - Denominator coefficient 2

All coefficients are stored in a fixed-point format with appropriate scaling to maintain precision and dynamic range throughout the filter calculation.

## Filter Types

The gain compensation biquads can implement several common filter types by programming the appropriate coefficients:

### Peaking Filter

A peaking filter provides boost or cut at a specific center frequency with a defined bandwidth (Q factor). This is useful for correcting frequency response anomalies at specific frequencies.

### Low-Shelf Filter

A low-shelf filter provides boost or cut below a specified corner frequency. This is commonly used to compensate for low-frequency roll-off in small enclosures.

### High-Shelf Filter

A high-shelf filter provides boost or cut above a specified corner frequency. This can be used to adjust the high-frequency response of the speaker system.

## Implementation Considerations

When configuring the gain compensation biquads, consider the following:

- Coefficient values must be calculated using appropriate filter design methods to achieve the desired frequency response
- Multiple biquads can be cascaded to implement more complex equalization curves
- Filter stability should be verified by ensuring poles remain inside the unit circle
- Gain settings should account for the overall system headroom to prevent clipping